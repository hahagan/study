恢复日志分为undo，redo和redo/undo三种。

# undo日志

## 规则

* u1：如果事务T改变了数据库元素X，那么<T,X,v>日志记录必须在X新值写入磁盘前写入磁盘，其中v为数据旧值。
* u2：如果事务T提交，其COMMIT日志记录必须在事务改变的所有数据库元素之后写入磁盘

## 恢复

1. 从尾部扫描日志
2. 如果事务T的commit已提交则不用处理
3. 如果事务T的commit未提交，则通过<T,X,v>恢复旧值
4. 对未完成的事务写入<ABORT T>记录

# redo日志

## 规则

* r1：在修改磁盘上任何元素X以前要保证与X相关的所有日志记录<T,X,v>及commit记录都记录到磁盘上。其中v为数据真值。

写入磁盘顺序：

1. 写入修改元素日志
2. commit日志记录
3. 改变数据库元素自身

## 恢复

1. 确认已提交事务
2. 从首部扫描日志，对<T,X,v>，如果是未提交事务则忽略，如果是已提交事务则尝试重做。
3. 对未完成事务写入<ABORT T>记录