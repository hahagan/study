# 一、负载均衡器算法

## 结构

主读写，从只读。多主架构，主节点负责分区不重叠。多负载均衡器负责完成到不同主节点间的选择。

## 实现

负载均衡器在负载写操作时选择对应的主节点，保证主节点间的数据域不会出现交集。

负载均衡器需要探知主节点的健康，在节点不健康后能够将负载迁移，在节点恢复后对已分配数据数据路由保持。

即集群分布式锁由负载均衡器完成，负载均衡器分散资源锁



# 二、集群内节点代理

## 结构

主读写，从只读。主节点间通过集群算法相互发现，并达成数据集的所有权分配。

## 实现

集群间需要算法探知集群状态。

写实现的两种方案

1. 客户端选择写节点，通过集群状态选择数据所有权节点。
   1. 客户端与集群节点保持长连接，并记录集群节点缓存。服务器通过连接推送集群状态
   2. 客户端通过集群节点状态选择写节点
2. 节点接收到数据后转发到数据所有节点。
   1. 节点接收数据后如果数据非本节点持有，转发到对应的持有节点。



# 三、分布式锁

## 结构

无主，每个节点都可以进行读写

## 实现

随机负载到各个节点，需要额外的机制提供分布式锁，各个节点竞争对应的分布式锁，获取读写权限。需要在多节点间实现cas或tas或ttas类似的同步原语。



