# 一、异常概念

在[编程语言](https://zh.wikipedia.org/wiki/编程语言)领域，通常 **异常**（英语：exception）这一术语所描述的是一种数据结构，该数据结构可以存储异常（exceptional）相关信息。异常处理的常见的一种机制是移交控制权。**引发**raise异常，也叫作**抛**throw异常，通过该方式达到移交控制权的效果。异常抛出后，控制权会被移交至某处的**接**catch，并执行处理。

编程语言对异常有着截然不同的定义，但现代语言大致上可分两类：[[3\]](https://zh.wikipedia.org/wiki/异常处理#cite_note-Kiniry-3)

- 用作于[控制流程](https://zh.wikipedia.org/wiki/控制流程)的异常，如：Ada, Java, Modula-3, ML, OCaml, Python, and Ruby fall in this category 。
- 用作于处理不正常、无法预测、错误性的情况。如：C++,[[4\]](https://zh.wikipedia.org/wiki/异常处理#cite_note-4) C#, Common Lisp, Eiffel, and Modula-2 。

系统异常可以分为两大类：**业务类异常**和**技术类异常**

|                | **可预测异常**                                               | **不可预测异常**                               |
| -------------- | ------------------------------------------------------------ | ---------------------------------------------- |
| **业务类异常** | 在发生异常处处理；将异常信息显示给用户；不要记录在日志中；日志中低级别记录异常或概要 | 抛出异常；将异常信息显示给用户；记录在日志中   |
| **技术类异常** | 在发生异常处处理 ；不要将异常信息显示给用户；日志中低级别记录异常或概要 | 抛出异常；不要将异常显示给用户；记录在日志中； |

异常是强类型的，类型安全的分支处理技术；而返回错误是其弱化的，不安全的版本

## 异常安全

一段代码是**异常安全的**，如果这段代码运行时的失败不会产生有害后果，如[内存泄露](https://zh.wikipedia.org/wiki/内存泄露)、存储数据混淆、或无效的输出。异常安全可分成不同层次：

1. **失败透明（failure transparency）**，也称作**不抛出保证（no throw guarantee）**：代码的运行保证能成功并满足所有的约束条件，即使存在异常情况。如果出现了异常，将不会对外进一步抛出该异常。（异常安全的最好的层次）
2. **提交或卷回的语义（commit or rollback semantics）**，或称作**强异常安全（strong exception safety）**或**无变化保证（no-change guarantee）**：运行可以是失败，但失败的运行保证不会有负效应，因此所有涉及的数据都保持代码运行前的初始值。[[33\]](https://zh.wikipedia.org/wiki/异常处理#cite_note-33)
3. **基本异常安全（basic exception safety）**：失败运行的已执行的操作可能引起了副作用，但会保证状态不变。所有存储数据保持有效值，即使这些数据与异常发生前的值有所不同。
4. **最小异常安全（minimal exception safety）**也称作**无泄漏保证（no-leak guarantee）**：失败运行的已执行的操作可能在存储数据中保存了无效的值，但不会引起崩溃，资源不会泄漏。
5. **异常不安全（no exception safety）**:没有保证（最差的异常安全层次）。



# 二、服务可用性增强

1. 重请求分阶段、异步轻量化，异步化过程注意数据一致性、任务反馈、请求管理和幂等性等等。
2. 柔性化，我们业务中允许的情况下，做不到给予用户百分百可用的，通过降级的手段给到用户尽可能多的服务，而不是非得每次都交出去要么 100 分或 0 分的答卷。
3. **架构分层**增强容错力，上层包容或处理下层错误
4. 轻量级应用动态扩容策略与负载故障转移
5. 服务限流与熔断避免错误向下雪崩
6. **服务治理**，服务划分，根据业务职责权重、服务能力、稳定性等进行服务划分与治理
7. 监控，业务监控、应用监控、系统监控、基础设施监控
8. 前后端分离、动静态分离



# REF

* [wiki异常处理](https://zh.wikipedia.org/wiki/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86)
* [wiki流程控制](https://zh.wikipedia.org/wiki/%E6%8E%A7%E5%88%B6%E6%B5%81%E7%A8%8B)